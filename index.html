<!Doctype html>
<html>

<head>
    <title>Diplomacy</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="UTF-8">
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-color: #808080;
        }
        
        #canvas {
            position: absolute;
            left: 0;
            top: 0;
            z-index: 0;
        }
        
        #interface {
            position: absolute;
            left: 0;
            top: 0;
            z-index: 1;
        }
    </style>
</head>

<body id="container">
    <canvas id="canvas"></canvas>
    <canvas id="interface"></canvas>

    <!--<script src = "objectModels/setDefaultModel.js"></script>
        <script src = "objectModels/setObjectOffset.js"></script>
        <script src = "objectModels/setObjectListening.js"></script>
        <script src = "objectModels/imageModel.js"></script>
        <script src = "objectModels/textModel.js"></script>
        <script src = "objectModels/rectModel.js"></script>-->
    <script src='options/gameCoords.js'></script>
    <script src='options/dictionaryEnumeration.js'></script>
    <script src='options/dictionaryToList.js'></script>
    <script src='options/gamestart.js'></script>
    <script src='options/save.js'></script>
    <script src='options/undo.js'></script>

    <script src='render/loadassets.js'></script>
    <script src='render/image.js'></script>
    <script src='render/rgbtohex.js'></script>
    <script src='render/draw.js'></script>

    <script src='interface/entityinterface.js'></script>
    <script src='interface/barrackinterface.js'></script>
    <script src='interface/towninterface.js'></script>

    <script src='sprites/sprite.js'></script>
    <script src='groups/spritesGroup.js'></script>

    <script src='sprites/empty.js'></script>
    <script src='sprites/elements/text.js'></script>
    <script src='sprites/elements/rect.js'></script>
    <script src='sprites/elements/button.js'></script>
    <script src='sprites/elements/image.js'></script>
    <script src='sprites/elements/imageButton.js'></script>
    <script src='sprites/elements/switch.js'></script>
    <script src='sprites/border.js'></script>

    <script src='events/geteventpos.js'></script>
    <script src='events/screen.js'></script>
    <script src='events/events.js'></script>

    <script src='interface/menu.js'></script>
    
    <script src='sprites/hexagon.js'></script>
    <script src='groups/grid.js'></script>

    <script src='sprites/entities/entity.js'></script>

    <script src='sprites/entities/units/unit/interactionWithUnit.js'></script>
    <script src='sprites/entities/units/unit/unit.js'></script>

    <script src='sprites/entities/units/noob.js'></script>

    <script src='sprites/entities/units/normchel.js'></script>

    <script src='sprites/entities/units/KOHb/mirroringInteraction.js'></script>
    <script src='sprites/entities/units/KOHb/KOHb.js'></script>

    <script src='sprites/entities/units/range/rangeUnit/interactionWithRangeUnit.js'></script>
    <script src='sprites/entities/units/range/rangeUnit/rangeUnit.js'></script>

    <script src='sprites/entities/units/range/archer.js'></script>

    <script src='sprites/entities/units/range/catapult/interactionWithCatapult.js'></script>
    <script src='sprites/entities/units/range/catapult/catapult.js'></script>

    <script src='sprites/entities/buildings/building.js'></script>

    <script src='sprites/entities/buildings/manufactures/manufacture.js'></script>
    <script src='sprites/entities/buildings/manufactures/farm.js'></script>

    <script src='sprites/entities/buildings/manufactures/preparingManufacture/production.js'></script>

    <script src='sprites/entities/buildings/manufactures/preparingManufacture/preparingManufacture.js'></script>
    <script src='sprites/entities/buildings/manufactures/preparingManufacture/barrack.js'></script>
    <script src='sprites/entities/buildings/manufactures/preparingManufacture/town.js'></script>

    <script src='player.js'></script>

    <script src='nextTurn.js'></script>
    <script>
        'use strict'
        /*if (document.querySelector("#container").requestFullscreen)
            document.querySelector("#container").requestFullscreen();
        else if (document.querySelector("#container").webkitRequestFullScreen)
            document.querySelector("#container").webkitRequestFullScreen()*/
    
        let mainCanvas = document.getElementById('canvas')
        
        let mainCtx = mainCanvas.getContext('2d')
        

        let interfaceCanvas = document.getElementById('interface')
        
        let interfaceCtx = interfaceCanvas.getContext('2d')

        let undoManager = new UndoManager()
        let unpacker = new JsonUnpackManager()
        
        let debug = false
        let barrackInterface = new BarrackInterface()
        let townInterface = new TownInterface()
        let entityInterface = new EntityInterface()
        let gameEvent = new Events(barrackInterface, townInterface, entityInterface)
        let border = new Border()
        let attackBorder = new Border()
        
        let saveManager = new SaveManager()
        
        let players = []
        let grid
        let mapBorder
        let gameExit = false

        let undoButton = new ImageButton(
            new JustImage('undo', {x: NaN, y: NaN}, nextTurnButtonSize, nextTurnButtonSize), 
            new Rect(0.25 * nextTurnButtonSize, HEIGHT - 1.25 * nextTurnButtonSize, 
                     nextTurnButtonSize, nextTurnButtonSize),
            undoManager.undo, undefined, undefined, undefined, undoManager
        )
        let backToMenuButtonSize = nextTurnButtonSize * 2 / 3
        let backToMenuButton = new ImageButton(
            new MenuIconImage({ x: NaN, y: NaN }, 'white', backToMenuButtonSize, 'black', 0.01 * HEIGHT, 0.005 * HEIGHT),
            new Rect(backToMenuButtonSize * 0.25, backToMenuButtonSize * 0.25,
                backToMenuButtonSize, backToMenuButtonSize),
            menuBack
        )                
        let whooseTurn
        function start1() {
            
        }
        function start2() {
            
        }
        function start() {
           
            interfaceCanvas.width = WIDTH
            interfaceCanvas.height = HEIGHT
            interfaceCanvas.style.width = WIDTH / window.devicePixelRatio + 'px'
            interfaceCanvas.style.height = HEIGHT / window.devicePixelRatio + 'px'
            
            mainCanvas.width = WIDTH
            mainCanvas.height = HEIGHT
            mainCanvas.style.width = WIDTH / window.devicePixelRatio + 'px'
            mainCanvas.style.height = HEIGHT / window.devicePixelRatio + 'px'
            
            loadAssets()

            //menu.start()
            requestAnimationFrame(waitForImagesLoad)
        }
        window.addEventListener('load', start)
    </script>
</body>

</html>